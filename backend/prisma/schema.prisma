// ------------------------------
// Prisma Generator + Datasource
// ------------------------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ------------------------------
// User Model
// ------------------------------

model User {
  id             Int      @id @default(autoincrement())
  name           String
  email          String   @unique
  password_hash  String

  branch               String?
  year                 Int?
  bio                  String?
  relationship_status  String?

  // OTP + Verification
  isVerified    Boolean   @default(false)
  otpCode       String?
  otpExpiresAt  DateTime?

  created_at    DateTime @default(now())

  // Relations
  anonymousPosts AnonymousPost[]
  bulletinPosts  BulletinPost[]
  upvotes        Upvote[]
}

// ------------------------------
// Anonymous Posts (Confessions & Tea)
// ------------------------------

model AnonymousPost {
  id         Int      @id @default(autoincrement())
  user_id    Int
  type       PostType
  content    String
  upvotes    Int      @default(0)
  created_at DateTime @default(now())

  user       User     @relation(fields: [user_id], references: [id])
  upvotedBy  Upvote[]
}

// ------------------------------
// Bulletin Board
// ------------------------------

model BulletinPost {
  id         Int      @id @default(autoincrement())
  title      String
  content    String
  tag        String?  // optional
  user       User?    @relation(fields: [user_id], references: [id])
  user_id    Int?
  created_at DateTime @default(now())
}
// ------------------------------
// Upvotes
// ------------------------------

model Upvote {
  id        Int      @id @default(autoincrement())
  user_id   Int
  post_id   Int

  user      User          @relation(fields: [user_id], references: [id])
  post      AnonymousPost @relation(fields: [post_id], references: [id])

  @@unique([user_id, post_id])
}

// ------------------------------
// Post Types
// ------------------------------

enum PostType {
  CONFESSION
  TEA
}

// ------------------------------
// Confession + Replies Feature
// ------------------------------

model Confession {
  id         Int                @id @default(autoincrement())
  content    String
  createdAt  DateTime           @default(now())

  replies    ConfessionReply[]
}

model ConfessionReply {
  id            Int        @id @default(autoincrement())
  content       String
  createdAt     DateTime   @default(now())

  confessionId  Int
  confession    Confession @relation(fields: [confessionId], references: [id])
}